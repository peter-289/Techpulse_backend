<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reset Password</title>
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: linear-gradient(180deg, #f8fcff 0%, #eef4fb 100%);
        color: #0f172a;
      }
      .wrap {
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 16px;
      }
      .card {
        width: 100%;
        max-width: 520px;
        background: #fff;
        border: 1px solid #d6e2ee;
        border-radius: 14px;
        padding: 18px;
        box-shadow: 0 18px 40px -34px rgba(2, 6, 23, 0.8);
      }
      h1 {
        margin: 0 0 8px;
        font-size: 1.45rem;
      }
      p {
        margin: 0 0 14px;
        color: #425466;
      }
      label {
        font-size: 0.85rem;
        font-weight: 700;
        color: #334e68;
      }
      input {
        margin-top: 6px;
        width: 100%;
        box-sizing: border-box;
        border: 1px solid #c6d4e2;
        border-radius: 10px;
        padding: 10px 12px;
      }
      .stack {
        display: grid;
        gap: 12px;
      }
      .btn {
        border: 0;
        border-radius: 10px;
        padding: 10px 12px;
        background: linear-gradient(180deg, #2096eb, #0f6ec3);
        color: #fff;
        font-weight: 700;
        cursor: pointer;
      }
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .msg {
        margin-top: 10px;
        font-size: 0.9rem;
      }
      .msg.error {
        color: #b91c1c;
      }
      .msg.success {
        color: #0f766e;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <h1>Reset your password</h1>
        <p>Enter a new password for your account.</p>
        <form id="reset-form" class="stack">
          <label>
            New Password
            <input type="password" id="new_password" name="new_password" required minlength="8" />
          </label>
          <label>
            Confirm Password
            <input type="password" id="confirm_password" name="confirm_password" required minlength="8" />
          </label>
          <button class="btn" id="submit-btn" type="submit">Reset Password</button>
        </form>
        <div id="message" class="msg"></div>
      </div>
    </div>
    <script>
      (function () {
        const token = __TOKEN_JSON__;
        const loginUrl = __LOGIN_URL_JSON__;
        const form = document.getElementById("reset-form");
        const submitBtn = document.getElementById("submit-btn");
        const messageEl = document.getElementById("message");

        form.addEventListener("submit", async function (event) {
          event.preventDefault();
          messageEl.className = "msg";
          messageEl.textContent = "";

          const newPassword = document.getElementById("new_password").value;
          const confirmPassword = document.getElementById("confirm_password").value;

          if (newPassword !== confirmPassword) {
            messageEl.className = "msg error";
            messageEl.textContent = "Passwords do not match.";
            return;
          }

          submitBtn.disabled = true;
          try {
            const body = new URLSearchParams();
            body.set("token", token);
            body.set("new_password", newPassword);
            body.set("confirm_password", confirmPassword);

            const response = await fetch("/api/v1/auth/password-reset/confirm", {
              method: "POST",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body: body.toString()
            });
            const result = await response.json();
            if (!response.ok) {
              throw new Error(result.detail || "Password reset failed.");
            }

            messageEl.className = "msg success";
            messageEl.textContent = "Password reset successful. Redirecting to login...";
            setTimeout(function () {
              window.location.href = loginUrl;
            }, 1200);
          } catch (error) {
            messageEl.className = "msg error";
            messageEl.textContent = error.message || "Password reset failed.";
          } finally {
            submitBtn.disabled = false;
          }
        });
      })();
    </script>
  </body>
</html>
